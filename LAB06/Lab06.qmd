---
title: "SQLite - Exercícios Básicos"
author: "Miguel Fiorin"
format: html
editor: visual
---

## **Atividade (LAB06)**

### Baixe o arquivo 'disco.db' e coloque na mesma pasta deste arquivo (Quarto Document)

```{r}
fname = 'disco.db'
```

### Utilizando o pacote `RSQLite`, conecte-se ao arquivo de banco de dados. Armazene a conexão na variável `conn`

```{r}
library(RSQLite)
conn = dbConnect(SQLite(), fname)
```

### Liste as tabelas existentes no banco de dados

```{r}
dbListTables(conn)
```

### Identifique os nomes de todas as colunas existentes na tabela `customers`

```{r}
dbListFields(conn, "customers")
```

### Utilizando **apenas** `SQLite`, com o apoio do comando `dbGetQuery`, identifique quantos clientes estão atualmente cadastrados neste banco de dados

```{r}
buscar_clientes_cadastrados = paste(
  "SELECT COUNT(CustomerId) as ClientesCadastrados",
  "FROM customers"
)
dbGetQuery(conn, buscar_clientes_cadastrados)
```

Logo, pode-se afirmar que há 59 clientes cadastrados no banco de dados.

### Utilizando **apenas** `SQLite`, identifique o número de países diferentes em que moram os clientes encontrados acima

```{r}
buscar_numero_paises = paste(
  "SELECT COUNT(DISTINCT Country) AS NumPaíses",
  "FROM customers"
)
dbGetQuery(conn, buscar_numero_paises)
```

Portanto, há 24 páises diferentes em que moram os clientes.

### Utilizando **apenas** `SQLite`, quantos clientes existem por país? A tabela resultante deve conter o nome do país e a respectiva contagem, além de ser ordenada de maneira decrescente pela referida contagem

```{r}
busca_cliente_por_pais = paste(
  "SELECT Country, COUNT(customerId) AS 'NumClientes'",
  "FROM customers",
  "GROUP BY Country",
  "ORDER BY COUNT(customerId) DESC"
)

dbGetQuery(conn, busca_cliente_por_pais)
```

### Quais são os 5 países com mais clientes registrados? Use apenas `SQLite`

```{r}
busca_5_paises= paste(
  "SELECT Country, COUNT(customerId) AS 'NumClientes'",
  "FROM customers",
  "GROUP BY Country",
  "ORDER BY COUNT(customerId) DESC",
  "LIMIT 5"
)

dbGetQuery(conn, busca_5_paises)
```

### Quais são os países registrados que possuem apenas 6 letras no nome?

```{r}
buscar_6letras = paste(
  "SELECT DISTINCT Country",
  "FROM customers",
  "WHERE LENGTH(Country) == 6"
)
dbGetQuery(conn, buscar_6letras)
```

### Quais foram as músicas compradas por clientes brasileiros?

```{r}
buscar_musicas_compradas_por_brasileiros = paste(
"SELECT DISTINCT t.Name
FROM customers c
JOIN invoices i ON c.CustomerId = i.CustomerId
JOIN invoice_items ii ON i.InvoiceId = ii.InvoiceId
JOIN tracks t ON ii.TrackId = t.TrackId
WHERE c.Country = 'Brazil';"
)
#dbListFields(conn, 'invoices')
#dbGetQuery(conn, "SELECT * FROM invoices LIMIT 10")

dbGetQuery(conn, buscar_musicas_compradas_por_brasileiros)
```

### Desconecte do Banco de Dados

```{r}
dbDisconnect(conn)
```
